- hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - vars.yml

  tasks:
    - name: Create datacenter
      ionos_cloud_datacenter:
        name: "{{ name }}"
        description: "{{ description }}"
        location: us/las
      register: datacenter

    - name: Create k8s cluster
      ionos_cloud_k8s_cluster:
        cluster_name: "my-cluster"
        maintenance_window:
          day_of_the_week: "Wednesday"
          time: "12:02:00"
        k8s_version: 1.19.2
      register: cluster

#    - name: Create k8s cluster nodepool
#      ionos_cloud_k8s_nodepool:
#        nodepool_name: "my-nodepool-8"
#        k8s_cluster_id:  "{{ cluster.id }}"
#        datacenter_id: "{{ datacenter.id }}"
#        node_count: "1"
#        cpu_family: "AMD_OPTERON"
#        cores_count: "1"
#        ram_size: "2048"
#        availability_zone: "AUTO"
#        storage_type: "SSD"
#        storage_size: "100"
#      register: nodepool
#
#    - name: Debug - Show nodepool
#      debug:
#         msg: "{{ nodepool }}"

    - name: Update k8s cluster nodepool
      ionos_cloud_k8s_nodepool:
        k8s_cluster_id: "{{ cluster.id }}"
        datacenter_id: "{{ datacenter.id }}"
        nodepool_id: "29731bf1-4741-4df9-bc9f-8fb9639c436f"
        node_count: "1"
        cpu_family: "AMD_OPTERON"
        cores_count: "1"
        ram_size: "2048"
        availability_zone: "AUTO"
        storage_type: "SSD"
        storage_size: "100"
        state: update
#
#    - name: Delete k8s cluster nodepool
#      ionos_cloud_k8s_nodepool:
#        k8s_cluster_id: "{{ cluster.id }}"
#        nodepool_id: "3baae59e-dee9-446c-99cd-201e148bb453"
#        wait: true
#        state: absent
#
#    - name: Delete k8s cluster
#      ionos_cloud_k8s_cluster:
#        k8s_cluster_id: "{{ cluster.id }}"
#        state: absent
#
#    - name: Remove datacenter
#      ionos_cloud_datacenter:
#         id: " {{ datacenter.id }}"
#         name: "{{ name }}"
#         state: absent