
- hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - vars.yml

  tasks:
  - name: Create datacenter
    ionos_cloud_datacenter:
      name: "{{ name }} - {{ 100 | random}}"
      description: "{{ description }}"
      location: us/las
    register: datacenter1

  - name: Create datacenter
    ionos_cloud_datacenter:
      name: "{{ name }} - {{ 100 | random}}"
      description: "{{ description }}"
      location: us/las
    register: datacenter2

  - name: Create group
    ionos_cloud_group:
      name: "Demo"
      create_datacenter: true
      create_snapshot: true
      reserve_ip: true
      access_activity_log: true

  - name: Create share
    ionos_cloud_share:
      group: Demo
      edit_privilege: True
      share_privilege: True
      resource_ids:
        - "{{ datacenter1.id }}"
        - "{{ datacenter2.id }}"
      state: present

  # Update shares
  - name: Update shares
    ionos_cloud_share:
      group: Demo
      edit_privilege: False
      share_privilege: False
      resource_ids:
        - "{{ datacenter2.id }}"
        - "{{ datacenter1.id }}"
      state: update

#   Remove shares
  - name: Remove shares
    ionos_cloud_share:
      group: Demo
      resource_ids:
        - "{{ datacenter2.id }}"
        - "{{ datacenter1.id }}"
      state: absent

  - name: Delete group
    ionos_cloud_group:
      name: "Demo"
      state: absent

  - name: Remove datacenter
    ionos_cloud_datacenter:
      id: "{{ datacenter1.id }}"
      state: absent

  - name: Remove datacenter
    ionos_cloud_datacenter:
      id: "{{ datacenter2.id }}"
      state: absent

