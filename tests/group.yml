- hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
    - vars.yml

  tasks:
    - set_fact:
        random_user: "no-reply{{100000000 |random}}@example.com"
      run_once: yes

    - name: Create group
      ionos_cloud_group:
        name: "{{ name }}"
        create_datacenter: true
        create_snapshot: true
        reserve_ip: true
        access_activity_log: true

    - name: Update group
      ionos_cloud_group:
        name: "{{ name }}"
        create_datacenter: false
        wait: true
        state: update

    - name: Create user
      ionos_cloud_user:
        firstname: John
        lastname: Doe
        email: "{{ random_user }}"
        user_password: "{{ password }}"
        administrator: false

    - name: Add user to group
      ionos_cloud_group:
        name: "{{ name }}"
        users:
          - "{{ random_user }}"
        state: update

    - name: Remove user from group
      ionos_cloud_group:
        name: "{{ name }}"
        users: []
        state: update

    - name: Delete user
      ionos_cloud_user:
        email: "{{ random_user }}"
        state: absent

    - name: Delete group
      ionos_cloud_group:
        name: "{{ name }}"
        state: absent